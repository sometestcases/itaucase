# Itau Case

Projeto que até o momento apresenta uma possível arquitetura, para um cenário hipotético, onde é necessário criar uma estrutura que comporte consulta de saldo de contas, e transferencia de saldo entre essas contas.


[Diagrama de Arquitetura da Solução](https://viewer.diagrams.net/?tags=%7B%7D&highlight=0000ff&edit=_blank&layers=1&nav=1&title=itaucase.drawio#R7V1Zc9s4Ev41qnUe7CJFUcejr8xMbWaSGnt3Z%2FcNIiEJCUVwQNKx8%2BsXjYsHSIm2JFOOlVQlIngBffeHBjjwrtePvzCUrH6nIY4GQyd8HHg3g%2BHQnUym%2FD9oeZIt0%2FFMNiwZCdVFRcMd%2BYFVo6NacxLitHJhRmmUkaTaGNA4xkFWaUOM0e%2FVyxY0qr41QUtsNdwFKLJb%2F0PCbKVGMZwU7b9islzpN7t6fGukL1YjSVcopN9LTd7twLtmlGby1%2FrxGkdAPE0Xed%2FHlrOmYwzHWZcb%2FkqHvv%2B%2Ff16unsaPXy6%2FT2b%2FWtyeT9Q4HlCUqxGr3mZPmgSM5nGI4SnuwLv6viIZvktQAGe%2Fc6bztlW2jtTpBY0zxUV3qI6vaUSZeJbnXsJf3p5mjH7DpTPX4g8%2FozqEWYYfW4fqGgJyycN0jTP2xC9RN4zGY3nLk%2BbKRDHhe8HD4Ui1rUr8G458JTtKbpbm4QVp%2BQ9F3WdQ2pv%2BjJR2Hb9K6mkDpUfjRko7h6L06GekdF2mp%2BOuIj0%2BFKFdi85Bnmb84ewcJWQ3mgOtCDfDlxFZxrxtTcIQHmQTeRxM8XwBbCFRVGoPEZ4uAs0%2B1Q13P8yYTZ0KM%2FxpAzOcBmbMDsWLJpkfR5kavnCQmjLjv3PwOVcgugj%2BlpvGS%2Fj%2Fl9v7AbiTj5qhKfRucqUPfwsHE%2F6kj2mGsjzVb5ozff%2FAv%2Frz9u5%2B4N80nFMt%2FHbZNd1cExccckesDinLVnRJYxTdFq1XhUA5%2FKi45hOlieL1V5xlT0p3UZ7RqpBxbrOnv9T94uC%2FcHDh68Obx%2FLJmyd1VDYIjm0QrsRfS%2FLEAGFUm4WOE4HmLMCbLJwKhBBb4mybgtpCzHCEMvJQ7cf%2BrcO0F5Y%2BksxwlP8uMZQfFfyEg6cyc%2F8qy4S8a%2FgcOZhscAx9sN7vlfczyxyhIOC8zS4ChnkHaNxoNO4H197gyktIQPnd%2F0SLb9w4OZf%2F%2FvOzMCUN4vQJzXnGUREBpFxGwImL2SZfwnBKfqC5eB7wM6EkzgQt%2FCt4YXfX36DpDQ5GJSnqjSZirwjCBl1qdUfOhTv1vYpHOlcxT2d%2Bq4d%2FARKUoo7qU4fV%2B%2BlikXIprEuL6eDLBWjo92o8lOor%2B%2BF2sx5lg%2FHfir3Ybj02yRaOw0vIZEGkI5SmJJCNH0mkOy6DIp2guv2YnKHXp8kZji2T8%2BXy%2FvpXGcfMUYTiAKswRtkiHcXMIxp82xzEvFvLM2zxI8byeK472qvlObxx8dqck0xb2gLWTYH0XPy1A2nOzm%2F5HLMYZ1z4inDYCn73%2FNI1jUlGGQJ%2FejkR%2F3rgUh8IONQ%2F8Hf%2B75844qZkQ59eKX8Tf%2Bz8beHD34b8raYJ8s%2BekuxpNcnuP68b9%2BsHX%2BQGndmk7AfPeYtrQusWZyiOvmBGONnAdHbJsw4RX%2FsdnV2vvs4Gbb98vlMZuzJlW5Lyfv3ZJl4e2J%2BNN%2Bo%2FF9WhO6m6M%2B%2FY3ZlvSYNrMziKSJLi7XYbpYmcRlmQRzAhnfl2WPCzZpdHXgPK3GCWD4Yxz3oxy4WJnY6nVazCcaZvxMJO34KF1dOPJaW6uf10e39bN7IGIW0ESE8muE13Nplgdzqd7WZ01bNqKL2BpQ5vk%2B3JPnsO6o3b5PGoSt3RsGeb3OT2Dm%2BUnzc5qCGaYRXXmaMU36B0VQF2nP3aXVeXTxy34bUnFS%2BlseWNN02Jsn%2F1%2Bc%2FL60%2B3TUY1XaEEfgZPEeFsZt52ZZtLgfg0Nw0o%2BLYUYvI5z%2FhjdBqaKqb7x6KQE7caJE18WyGnDQrpOgfTyH7CJJW96t8yQJp0nAPaYSrwmEFct2tiKx1VX%2Brv2XGXVvk0QXFFljTspbCxS%2Bjkco7O%2BCP4y53afx8EPR3gz%2FkCrUn0JG9Z05im0hqY81K14ayTPMp2rpbZuQrGLkU3EJMomVMYiPNqV8543iLfPhzN1A9fdcTC7IZ%2BvYrO53SDVlEiZo40HX1BSd5yA7%2FB9%2FpAK5%2BTf9u1rrlWi9KLHjMsHiPZZc4EYXARpuzCnvPzBTP5hcKC%2B2LwcMT%2Fgdm%2FoX%2FNvY%2BvZwB9Mwfoq1lAftlN8VopC%2Ba1RQgNjxQWAc654lDyDo5VKA2N1WAaTqpwGk4WATWccESbCqrVK%2F0r3aGSIRCvHJo2aQx0H7VBMHeYEZSYorxAE7%2FKQXcD0yx%2BmlsNKwuV9sFzFNwczy6mIyjoGo4914fCQP3Qp9JVM5%2BnmsUfKJfTl6G0uG5ZektdnMShkalyY1XS1XWWShi0WlqEDeUjRzJFs%2F8Uarg5h%2BIplOMNq7nP0cNYnh35nWoGDiojrudXZcQ%2FdhlxbazzkvvuFS443zpp5WyP%2FbvW87SH8fW5qghE7QtNiRDfBvn6VLvAyFl3iVxRRn7w96Jq0rhTLjGs4a0Nuf2kIZWYegdLJXqtJqumEofJJLbisx3Ti1YswUYg9phfaHxre34x6jO%2F0N0sGRBVGnK%2BRjFaYnYekTTDMQSIp0KAUyGAXkHiOH1XAuglR2%2BjRPqNW7PONW%2B9WjMd4x8n4t035NWZiTvXSotb%2BVjRU%2BkCDRW0TU7Naut5ZrXle8%2B6nP%2BQ799vSmZXyilveYEyuibBOU0wO6Vmz03NvBaMtZSa1bB8vdZq13LuSfWOw2Vq434LuCvx%2BnBzwF4WCu9kz3Z1SmO7EFsbjTwJUYbfnqnYJBWHrlfbWn%2FtuFWkb0egT5dh1FZ%2B6IqGV1j60ep0TIp2KtM%2BZWdNwVCPyZm9%2FvZKCu3gVLawpWxhVE%2B1e69b8HvPqzrGIf1kx17XWoJRS5x72MTKHVkSpXb1aMut7Dtcf1STogOkV%2F4RYdo%2FSYzcWTT9SZ8xsm%2Bvjy5WcGQMxelC7LlwvPXDPYbE%2FubF0LDcaDI7%2BqlMz57KJMAirsrnWgJOcxGnaBfc1%2BToJiN0EfcbgHf2srvHUfu8cUef1%2B8C%2FZFd31NatSjgZJUyfd4IKp8c4Mhp5qPBhBx%2FXMWEdkSPX8Eb2qCh7Q1PsM%2FJEVbEun%2FcZ9T3QtDqljPbVtm%2FGZc26ejSvF6mbl23Vh%2FnaqlrRRi23XEghOEFyylqKyDcoV4CIU58V1oFpyaOrDasW7htc8RW6XZhXg%2FSn1cY8vYZrKOsWt9kAw4Qt2ytSJ45tVmno69an%2FS7y2F1ozKT%2Bzxvo7IdvYbZ7vLNeI1xC4J0WK8xqi3JcEeTzU7D98YbbzhQ0Y%2B9u8yhauw3mZ%2BuNfa7h5Xafmkq%2Bw3oijv2G8LKycHCyqHFg99UOsRb71VCNDhNLW5JGHy%2Fjpw1ZAxuU8bgDqewZPhA7O2llPetBP%2BjrniW17KZ0yvhWfYeHwWeZYEXzTtPchY1NJ9Ar1ad2RA8%2Bk7VvR596DiyMS%2FPZvDb3iTG9WoxzLjp%2BxCvuUuMb4c33J%2Fh%2BBxUdikT1Z%2F98wWuX%2FuYhNnLp799LnvZvGe39X0XPyX2pj8XcuQlFHqG49nQVhc459nFGBs%2BcvF%2B8Z7xZit07lyM%2FXrh1bE77XGDi35NvGfykh15y2ZqD0v3jro4sbP52rk4cTfzZSPz9oRnwHgs8pXOT7Oe73nWs23pX3%2FBmo7hjz9YewF03ZPZ6oxdt0yivNLO46Ne3d%2B75vyk1%2FKtcVPeLJdlpRixYHUqz3nnjsraM8OdTS78vl3V8Hhc1W5rLI7IYnXdwr1nX9Xvt1PeN%2Bt7dlb23EzNWZ1WVpw8lu2xPKd%2Fj6U%2FIN%2B4lPhOSO%2FgNPG%2FZU1x%2FQPww1ETYxtXFbsHC0XsjQ0aGHstS20aweab3%2B7ePWs9q5DWOwLW2jq7dTKivlf4WO0Qbv4v71jeNGmxaeNx39f7jRc%2Fmjceb96b5XklujsP5dkVu0dCvH2V%2FcLu8oODzQBBkKr12FLPmIKuV7yxbuoYlO5DqeuOuOkDX25TCd7B6gSmPU%2F0vGCe52dd4DjtOqUz7nVGemrvAWPsptb8X27VvPJce%2F628i%2B45n1OG09bUsfS%2Bv7RqPbN4aMv9pra830NUPrbLvaa1aNut%2B9Pgk3tTRa0fq1crV2f5ylmD6Xc%2BcrHaUkNiyt1Y6Ibzvmz72kIX75wAkQexQ%2B8hiMS%2F0AyemA44erGaYjgRA7%2FIE7lBYLqTyfFnMAopPJakopG0Rf1yRhxw5oEjJ5DP4nsJ1z1N3xzxWH8%2FXAndzwJN8qg%2BvwQHujQnLN7ayzVHAmRmGQEtpRvDs%2FQGkQynqdJI56BzVAD2JmeCKSlNlYsuIdRtFZ95sMjgkYJo9xN0rR0SyrvCehaUhR2zJeRFyNlMqYX7eBK0QJ8%2B5w20lVwMH6gkXy%2FGgjSDIbIkXHLrXjLX5qRaCV6Dd1Y43QN%2FweybyFZUhWFYnlDWoAzKdUDlyxWt%2BQRnAzJArMyL9WTtxFekU6%2BTApIhnXvuIRE9KlErc7EupdCxh%2BYZsUIQnh8G%2FYUYm6bCAi7oB0TlFCiKiot6zdI3sKvMmA1dM4SyqU6lFxmhVg7NXVIyZpEiH0ojz3n3CGgiErvloqkMHxgDPohnii7mGQ5tNbHL0aZKS1fS9XMGHercDwXx26qDuVFKOE9twyKw90hTqUAuFzS06IfmoZMEWCRxwHhgSMICDWSD2eyFdfU5SrJM21c0oTGqegiWSshwzxag0cxpMUOJSF8UUjoHH7kXqXStwYxOPvCnyCGCnTj3UaCpQFJa%2Bz%2FOxdrUri0MtFdtE0u8hQxrexCrqOV6Kxk2IKmYjABZQmFatwH9KGrkP5RvITEQZSLwxtB%2BHgl%2BJ8C6rs2XYzoMi1Ie5dEefytLD0xEsZIcgwCqVK%2Fq8ykBS8FlxgSqI54C1dJHgOtpW8Ax00WPFlUBo0PUr4LBQyHJCvsOklT2j7ylgR9j0aeu6t5IQEZJyEyfZN6KM1iShWlK6psuFeR3kRwGj%2FidSKsnPYQECiKU9IGpIoTTkwNA3iKLclcAOwX281hqzWjxvqnDeY%2FY3iZC53NtE9qtb3P5YQFScxpFEpMogZEzBT8MFORgOuM2r5ihxiwUXoYFIshkUXp2tLi5pFe3LwXBORX8%2FGZLzS8BKCBpxvFtMpziVPrCHyFDF4%2FddX%2F46MjwF7FouOI9tXx8pST3aMX3NJG6vqDuMovyDKXsaDU8tK8mTGlGIRJeAvuXeEiblHir9rIRtzfZ8bKXn%2F5Fyf573ito0Jh5aUxMhHoBmu6eX7OBIxzHvsJIyFeGsrI1JnLmF8aObDjqfK13xQeeCasZrCSzodbF%2B6I2JMKVaSX4S6LJMLCYfi4pLQ6NmkqZrl78JYOGuIuFZcIezdoC4blHKKodJcpCrfdWHh6Vhh86f8yKGA1DCEsyAnIyRXD6Nsm8ndmSItS8eak3mY17Df%2FeZ4eeC16sINEPoskW%2BHmrpgwfCmVxEve4BdH9wLcPB%2B2rf6mD5gtIoEfrkjIY%2FlBHSndGWx68ZfNXBuhmI1HNkThjQ%2BGUdjLAG2M4mOUP4I2tvqaDSDFT%2BF6%2BPAcsGVGEV6si36LLl6Dy7ByWO0%2FUnH3NuNU7lWFU4H0RwpIoDJNAl%2BC5Anl8GQ8HBFs8AKRhmCZE%2FFEAnIOkSCiH8pxPABvKtmmQhewMsvmccKvSCf6INwuHPwjyNOMS7LYXe0fKlhHTZkHvxt%2Flem7egJcS3N4UvFa%2FEjEW67V2xnmgX1sUv9gI5EHMrMQOZUY91K86Wz0%2BKhcpaIEjsNEQbchfigykmCF1jKmSLBIMBagNwOdtiguKIaqxFjGC2nxDH5R2AADlHuW5HPI8MWQpIuWfl5zrAGdEKNMUSR6R5gMAwROYAAI6FYnRGZYU4YXhHDznXTlt1jmdu2cFPdvyplersBtQaUIEOVMiv5ShJHWjcqnFDAjcL3kT6h%2FFdoTSrQiXSs%2BzyPKpQpJYIqWmCsEovbJigGEgBJEEdth1SkHEJfRFiERCxStkFFGo1dqFGKJUAOCxoNTpmFDEZPy%2FpVRJKGuZTLovF50XilZJsG%2BB%2FzDaI54Opf3VCJvoUEtC%2FosaIncIX2OsqJYxrah6lkQ5WWYqZ1qUskLVEch4hgp0K8wV9a9ZwDK5%2BvCOOicg3ONsapSWsIgkBsGaBhuv6UsYTDAD4V9ELchQwOk%2Bc0297kukWVqgrEMUQ1UekBE0GcZCx9RwGwoWm4SJOUpWiUIRwWwrMR%2Bu9X6fHUnNfieoR8K0FUiwl%2BX5aXED2YxWOE0JEGvB9rvSZRIYXQlcTAcARteIFRb8eYmU12SdomfVwVQpU78RZmCflX2xzub5lEBg2qrgDWxBa4fEDUgHmcZjC2UkB9kWNhCDrVtBQUXt1wWD1Gv7iY1qDxPwVmYFCrQQSSoNDB6DucMhktCPiSiLYLuNP%2FJif6Ai1ig6ENWwg%2BbXwdTPCyTqiF6fHV5ffuH4VqIRG8SmgJAJyyPuEqpopJXKT4l%2FNBIUydM2Ru0xJz3VT6aBFoHFgoAl77CuSdZHnFDEKJQurBOPrFyjREcTWSeLIhBhwXbtNnRMHSeMSUe8SbPoxWkYatdZT6UORU0TnAsBqheaaxXCfu2PN918Qyp9PLmxt6EDWrCA1bBwNFaIvCa2pLSuVI%2BRfmzryZIU%2FZBmRiNIK3nCogvzWPFZZUQCM8HO%2FpWD6CN9CrKyVVsJ8zAmugJHW6plUSWokX5eGM01kVkyI3Gg3EGdXLEppeaYGExQYrNMzIJ0YjZTGkNS0zS2lRjqHD5RQpQNq5C0ZeoQKx4rAJvUMFViuWEGiYqx%2BCqLy2b0QcZLzAaixXNTtlDaecEc9lSRsQdfw2U8YUfaxIDvPwi0H975va85v2DUMeXg3cNu0fSSrYwxWTXjW7xZdbwc2FlhOSpymlps1KBT6Z6ar3kjssxel0%2Bm%2BM2GeaRNSbMmAmF7mpdsxXFROoySIKkXUwrO%2FHAmstq0uK67Eo90RUhvOe5MKWNwyhsCQmpyWaySomqeJd%2BSqP91UQKS%2BYcFLBIZWpGKyybuDo%2FW7qeIWkQy4j533mpUdvhfeliSB7egTa%2BxPa1ULCBYK8Bqp8g7sG%2B6%2FAaaqndxjq84fNBbn7IKDCyqJbkJFn9TkOoTr39Pw%3D%3D)

# Fluxos

1 - Criação de contas: cria uma conta bancaria para um cliente, e nesse processo faz a verificação se o cliente esta ativo na 'customer-api', caso
esteja inativo, ou não exista, o retorno da criação de conta será negativo(4xx), esse endpoint deve ser chamado pelo fluxo que cria contas, após ser criada
será publicada no kafka, e o serviço de saldo ira replicar a conta.

2 - Inativação de conta: o o account-manager inativa uma conta bancaria a partir do id do cliente da mesma, bloqueando o saldo no balance-manager (essa operação pode retornar falha caso exista uma transação concorrente em andamento, ou a conta tenha saldo), toda vez que o cadastro de um cliente for inativado esse endpoint deve ser chamado antes da conclusão da operação pelo sistema que realiza a inativação (presumo que para encerrar a conta do cliente, precise encerrar a conta bancaria antes), e se a chamada falhar a inativação do cliente deve ser negada, porque vai significar que alguma transação esta em andamento, ou ele tem saldo

OBS: Trazendo esse status para dentro da conta, faz com que não precise criar uma integração com o serviço de cadastro em operações criticas como consulta de saldo e transferencia, além disso impede problemas de concorrência, como inativação do cliente ao mesmo tempo que uma transação esta ocorrendo, (considerei um problema grave, o cliente ter uma transação reportada ao BACEN com data posterior ao encerramento da própria conta)

3 - Transferencia entre contas de mesma Titularidade:  transfere um valor de uma conta para outra, nessa operação a internal-transfer-api vai realizar apenas uma chamada para o balance-manager, realizando uma operação de transferencia atômica entre as duas contas (já que nesse caso ambas estão no mesmo banco), e nesse caso o internal-transfer-listener ira consumir o evento do kafka e no consumo ira salvar a transferencia no banco de dados, e ira tentar enviar para o BACEN apenas uma vez, caso não consiga, a retentativa sera feita através de um cronjob que vai ficar rodando de X em X minutos. 

4 - Consulta de saldo:  O balance search api simplesmente consulta o saldo através da conta bancaria, primeiro no redis, e caso não exista ele procura n próprio banco de dados
que é atualizado através do consumidor do tópico de atualização de saldo do balance manager (no consumo do evento  é atualizado tanto o redis quanto o banco)



